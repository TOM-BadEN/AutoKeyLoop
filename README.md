[ğŸ‡¨ğŸ‡³ ä¸­æ–‡](#ä¸­æ–‡) | [EN English](#english)

https://github.com/user-attachments/assets/d7f530b9-baed-455c-9887-5b7a96a9dadf

---

<a name="ä¸­æ–‡"></a>
# ä¸­æ–‡

**å¦‚æœä½ å¯¹é€šçŸ¥æ¨¡å—æ„Ÿå…´è¶£ï¼Œå¯ä»¥è®¿é—® [é€šçŸ¥æ¨¡å—](https://github.com/TOM-BadEN/NX-Notification) NX-Notification**

## æ³¨æ„

- **æ³¨æ„ï¼šå› ä¸ºSWITCHçš„åº•å±‚ç‰¹æ®Šæœºåˆ¶ï¼Œéƒ¨åˆ†åŠŸèƒ½è¡¨ç°å¯èƒ½æœ‰ç‘•ç–µï¼Œå…·ä½“è§ä¸‹è¡¨ã€‚**
- æˆ‘å¹¶éç¨‹åºå‘˜ï¼Œå·²ç»å°½åŠ›äº†ï¼Œè™½æœ‰ç‘•ç–µï¼Œä½†è‡³å°‘å„åŠŸèƒ½å±äºèƒ½ç”¨çš„çŠ¶æ€ã€‚
- æƒ³è¦å®Œç¾å®ç°æ‰€æœ‰åŠŸèƒ½ï¼Œéœ€è¦é€šè¿‡å¤§æ°”å±‚çš„MITMåŠ«æŒæ¥è¾¾åˆ°ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šï¼Œè€Œä¸”éœ€è¦å®Œå…¨é‡æ„ã€‚

## å½“å‰åŠŸèƒ½ç‘•ç–µè¡¨ç°

æˆ‘çš„OLED+JCå°†åœ¨è¿™å‡ å¤©åˆ°è´§ï¼Œåˆ°æ—¶å€™æˆ‘ä¼šè¿›è¡Œè¯¦ç»†çš„æµ‹è¯•ï¼Œä»¥åŠå°è¯•ä¿®å¤ï¼Œä½†æ˜¯æ®æˆ‘ç›®å‰çš„äº†è§£ä»¥åŠä¹‹å‰çš„é€šè¿‡åˆ«äººæµ‹è¯•ï¼Œ æˆ‘æ¥ä¿®å¤çš„å¤±è´¥ç»éªŒæ¥çœ‹ï¼ŒJCçš„ç›¸å…³é—®é¢˜ä¿®å¤çš„æ¦‚ç‡å¾ˆä½ã€‚

| åŠŸèƒ½ | Joycon | LITE |
|------|--------|------|
| æŒ‰é”®è¿å‘ | åªæŒ‰è¿å‘å®Œç¾ï¼Œä½†è‹¥åœ¨è¿å‘è¿‡ç¨‹ä¸­è¿›è¡Œåˆ«çš„æ“ä½œï¼Œèåˆçš„ä¸å¥½ | å®Œç¾ |
| æŒ‰é”®æ˜ å°„ | å®Œç¾ | å®Œç¾ |
| æŒ‰é”®å® | å®ç»“æŸåï¼Œå¯èƒ½å‡ºç°æ‘‡æ†æ— æ³•å½’ä½çš„æƒ…å†µï¼Œç¢°ä¸€ä¸‹æ‘‡æ†æ¢å¤æ­£å¸¸ | å®Œç¾ |

| ç»„åˆåŠŸèƒ½ | Joycon | LITE |
|----------|--------|------|
| è¿å‘+æ˜ å°„ | åŒæŒ‰é”®è¿å‘ | å®Œç¾ |
| è¿å‘+å® | å®æ’­æ”¾æœŸé—´æ’ä»¶å°†æš‚æ—¶å±è”½è¿å‘åŠŸèƒ½ | å®æ’­æ”¾æœŸé—´æ’ä»¶å°†æš‚æ—¶å±è”½è¿å‘åŠŸèƒ½ |
| æ˜ å°„+å® | å¦‚æœæ’­æ”¾çš„å®çš„æŒ‰é”®ï¼Œæ°å¥½æ˜¯ä¿®æ”¹äº†æ˜ å°„çš„æŒ‰é”®ï¼Œå¯èƒ½å‡ºç°è¾“å…¥ä¸å¯¹çš„æƒ…å†µ | å¦‚æœæ’­æ”¾çš„å®çš„æŒ‰é”®ï¼Œæ°å¥½æ˜¯ä¿®æ”¹äº†æ˜ å°„çš„æŒ‰é”®ï¼Œå¯èƒ½å‡ºç°è¾“å…¥ä¸å¯¹çš„æƒ…å†µ | 

## é¡¹ç›®å®ç°åŸç†

é€šè¿‡åœ¨'HIDå†…å­˜'ä¸Šï¼Œç”³è¯·ä¸€å—'HDLsçš„ç¼“å†²åŒº'ã€‚
ä½¿ç”¨'hidGetNpadStatesHandheld'ç­‰APIï¼Œè¯»å–æ‰‹æŸ„çš„æŒ‰é”®ä¸æ‘‡æ†æ•°æ®ï¼ˆå®é™…ä¸Šå°±æ˜¯ä»HIDå†…å­˜è¯»å–ï¼‰ï¼Œ
è¿›è¿‡ç®—æ³•åˆ¤æ–­ï¼Œä¿®æ”¹æŒ‰é”®ä¸æ‘‡æ†æ•°æ®ï¼Œ
å†ä½¿ç”¨'hiddbgApplyHdlsStateList'æ³¨å…¥å›HIDå†…å­˜ï¼ˆæ­¤æ—¶æŒ‰é”®ç”Ÿæ•ˆï¼‰ã€‚

ä½†æ˜¯è¯¥æ–¹æ³•å­˜åœ¨ä»¥ä¸‹é—®é¢˜ã€‚

1. æ³¨å…¥çš„æŒ‰é”®å’Œæ‘‡æ†æ•°æ®ï¼Œä¼šè¢«hidGetNpadStatesHandheldå†æ¬¡è¯»å–åˆ°ï¼Œä»è€Œå¯¼è‡´æ— æ³•è¯»å–åˆ°çœŸæ­£çš„ç”¨æˆ·è¾“å…¥ã€‚ä¸è¿‡å¥½åœ¨é€šè¿‡ç®—æ³•æ§åˆ¶ï¼Œå‹‰å¼ºçš„è®©ç¨‹åºèƒ½æ­£ç¡®çš„è¿è¡Œèµ·æ¥ã€‚ç›®å‰JCå­˜åœ¨ä¸Šé¢è¡¨æ ¼çš„é—®é¢˜ï¼ŒLITEåˆ™è¡¨ç°å®Œç¾ã€‚

2. JOYCONä¸çŸ¥é“å­˜åœ¨ä»€ä¹ˆç‰¹æ®Šæœºåˆ¶ï¼Œå¦‚æœæ³¨å…¥æ‘‡æ†æˆ–è€…å…¶ä»–æŒ‰é”®ï¼Œå°±ä¼šå¯¼è‡´å³ä½¿ä»£ç åœæ­¢æ³¨å…¥ï¼Œç”¨æˆ·å®Œå…¨ä¸ç¢°æ‰‹æŸ„ï¼Œä½†æ˜¯æ‘‡æ†ä»æ—§ä¸€ç›´è§¦å‘ï¼Œé€šè¿‡è¯»å–å‘ç°ä¸€ç›´è§¦å‘çš„æœ€åæ³¨å…¥çš„æ•°æ®ï¼Œä½†æ˜¯å¯¹äºSWITCH LITEå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™å°±éå¸¸å¥‡æ€ªï¼Œä¸çŸ¥é“åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æš‚æ—¶å¼ºåˆ¶JCæ³¨å…¥çš„æ—¶å€™å¼ºåˆ¶å°†éè¿å‘æŒ‰é”®ä»¥åŠæ‘‡æ†ä¿®æ”¹ä¸º0ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´åœ¨è¿å‘æœŸé—´æ— æ³•æ­£å¸¸çš„è¿›è¡Œå…¶ä»–æŒ‰é”®çš„æ“ä½œã€‚

3. é€šè¿‡æ ‡å‡†çš„APIï¼Œä¿®æ”¹æŒ‰é”®æ˜ å°„åï¼Œå¦‚X->Y,Y->Xã€‚æ¥ç€æˆ‘ä»¬æŒç»­æ³¨å…¥Yï¼Œä½†æ˜¯æ¸¸æˆä¸­å®é™…è¡¨ç°ä¸ºYä¸­æºå…¥äº†Xã€‚é’ˆå¯¹è¿å‘åŠŸèƒ½ï¼Œé‡‡ç”¨äº†é€†æ˜ å°„çš„ç®—æ³•ï¼Œä¿®æ­£äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¯¼è‡´é—®é¢˜çš„æœºåˆ¶ï¼Œä»ç„¶æä¸æ¸…æ¥šã€‚è€Œé’ˆå¯¹å®åŠŸèƒ½ï¼Œåˆ™å®Œå…¨æ— è®ºèƒ½åŠ›ï¼Œå› æ­¤æ­£å¦‚ä¸Šè¡¨æ‰€è¯´ï¼Œå¦‚æœæ’­æ”¾çš„å®çš„æŒ‰é”®ï¼Œæ°å¥½æ˜¯ä¿®æ”¹äº†æ˜ å°„çš„æŒ‰é”®ï¼Œå¯èƒ½å‡ºç°è¾“å…¥ä¸å¯¹çš„æƒ…å†µã€‚

**å¦‚æœæœ‰å¤§ä½¬çŸ¥é“å¦‚ä½•è§£å†³ï¼Œæˆ–è€…å¯¼è‡´é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œè¿˜è¯·åŠ³çƒ¦ä¼ é“ä¸€ä¸‹ã€‚**

ç›®å‰å·²çŸ¥çš„å¯èƒ½çš„å®Œç¾è§£å†³åŠæ³•ï¼Œå°±æ˜¯æ”¹ç”¨AMSçš„MITMï¼Œé€šè¿‡æ‹¦æˆªæ¸¸æˆå¯¹HIDå†…å­˜çš„è®¿é—®ï¼Œè®¾ç½®ä¸€ä¸ªå½±å­å†…å­˜ï¼Œè®©æ¸¸æˆåªè®¿é—®å®Œå…¨å—æˆ‘ä»¬æ§åˆ¶çš„å½±å­å†…å­˜ã€‚ä½†æ˜¯æˆ‘ä¸æ˜¯ç¨‹åºå‘˜ï¼Œè€Œä¸”MITMå¤ªå¤æ‚äº†ï¼Œæ²¡æœ‰æ¨¡æ¿å’Œæ–‡æ¡£ï¼Œæˆ‘æ— èƒ½ä¸ºåŠ›ã€‚


# KeyX æŒ‰é”®åŠ©æ‰‹

[![bilibili](https://img.shields.io/badge/ã‚šã‚šã‚™ã‚šã‚šã‚šã‚šç©å®¶?logo=C++.svg)](https://www.bilibili.com/video/BV1u12cBvEmD/?spm_id_from=333.1387.homepage.video_card.click&vd_source=ee56f275632e70ae7ca2577aa1a56b81)
[![Latest Version](https://img.shields.io/github/v/release/TOM-BadEN/KeyX?label=latest&color=blue)](https://github.com/TOM-BadEN/KeyX/releases/latest)
[![GitHub Downloads](https://img.shields.io/github/downloads/TOM-BadEN/KeyX/total?color=6f42c1)](https://somsubhra.github.io/github-release-stats/?username=TOM-BadEN&repository=KeyX&page=1&per_page=300)

Nintendo Switch æŒ‰é”®åŠ©æ‰‹ï¼Œæ”¯æŒè¿å‘ã€æŒ‰é”®é‡æ–°åˆ†é…ã€æŒ‰é”®å®ä¸‰å¤§åŠŸèƒ½ã€‚ä¸”æ‹¥æœ‰å…¨å±€æˆ–æ¸¸æˆç‹¬ç«‹é…ç½®ï¼Œæ ¹æ®è®°å¿†è‡ªåŠ¨å¯åŠ¨åŠŸèƒ½ã€‚
æ•´ä¸ªæ’ä»¶ç”±ç‰¹æ–¯æ‹‰æ’ä»¶ä¸ç³»ç»Ÿæ¨¡å—ä¸¤éƒ¨åˆ†ç»„æˆã€‚

## åŠŸèƒ½

![Teslaç•Œé¢](image/tesla.jpg)       
![å½•åˆ¶æŒ‰é”®å®](image/recording.jpg)

- ç¾è§‚ç°ä»£çš„UIè®¾è®¡
- å¯åŠ¨æ€ä¿®æ”¹è¿å‘ä¸æ˜ å°„æŒ‰é”®
- å¯ä½¿ç”¨ç‰¹æ–¯æ‹‰ç›´æ¥å½•åˆ¶æŒ‰é”®å®ï¼Œä¸”åŠŸèƒ½å¼•å¯¼å®Œå–„
- å¯é€‰æ‹©å¼€å¯é¢å¤–çš„é€šçŸ¥å¼¹çª—
- ä¸»é¡µçš„è“è‰²å›¾æ ‡ä»£è¡¨è¯¥æŒ‰é”®ä¿®æ”¹äº†æ˜ å°„
- ä¸»é¡µçš„é»„è‰²è§’æ ‡ä»£è¡¨è¯¥æŒ‰é”®å¯ç”¨äº†è¿å‘
- ä¸»é¡µçš„çº¢è‰²è§’æ ‡ä»£è¡¨è¯¥æŒ‰é”®ç»‘å®šäº†å®

### æŒ‰é”®æ˜ å°„

- æ”¯æŒ 16 ä¸ªæŒ‰é”®äº’ç›¸æ˜ å°„ (A/B/X/Y/L/R/ZL/ZR/åå­—é”®/SELECT/START/L3/R3)
- ä¸è¿å‘åŠŸèƒ½å¯åŒæ—¶å¯ç”¨ï¼Œä¸ä¼šæœ‰å†²çª
- **å®Œç¾é¿å¼€ç³»ç»Ÿå…³äºæŒ‰é”®ä¿®æ”¹åçš„è­¦å‘Šå¼¹çª—**
- å…¨å±€é…ç½®å’Œæ¸¸æˆç‹¬ç«‹é…ç½®
- è‡ªåŠ¨è®°å¿†å¼€å…³çŠ¶æ€

### æŒ‰é”®è¿å‘ 

- æ”¯æŒ 12 ä¸ªæŒ‰é”®è¿å‘ï¼ˆA/B/X/Y/L/R/ZL/ZR/åå­—é”®ï¼‰
- æ”¯æŒå¤šä¸ªæŒ‰é”®åŒæ—¶è¿å‘
- è¿å‘æ—¶æ”¯æŒéè¿å‘é”®æ­£å¸¸ä½¿ç”¨
- å¯è®¾ç½®æŒ‰ä¸‹å’Œæ¾å¼€æ—¶é•¿
- å…¨å±€é…ç½®å’Œæ¸¸æˆç‹¬ç«‹é…ç½®
- è‡ªåŠ¨è®°å¿†å¼€å…³çŠ¶æ€

### æŒ‰é”®å®

- è‡ªåŠ¨è®°å¿†å®åŠŸèƒ½å¼€å…³çŠ¶æ€
- æ‘‡æ†ä¸æŒ‰é”®çŠ¶æ€å‡ä¼šè¢«å½•åˆ¶
- æœ€å¤§å½•åˆ¶æ—¶é•¿ä¸º30s
- å½•åˆ¶å¸§ç‡ä¸º60FPS
- æŒ‰ä¸€ä¸‹å¯¹åº”å¿«æ·é”®ä¸ºå•æ¬¡æ’­æ”¾
- æŒ‰ä½å¯¹åº”å¿«æ·é”®ä¸ºå¾ªç¯æ’­æ”¾
- æ’­æ”¾æœŸé—´å†æ¬¡æŒ‰ä¸‹å¿«æ·é”®å–æ¶ˆæ’­æ”¾

## å†…å­˜å ç”¨

- ç³»ç»Ÿæ¨¡å—ä»…å ç”¨ 343 KB
- å¼¹çª—é¢å¤–å ç”¨ 688 KB
- **å¼¹çª—åªæœ‰è§¦å‘çš„æ—¶å€™æ‰æœ‰å†…å­˜å ç”¨**

## å®‰è£…

å°†æ–‡ä»¶å¤åˆ¶åˆ° SD å¡æ ¹ç›®å½•ï¼š
```
/atmosphere/contents/4100000002025924/
/atmosphere/contents/0100000000251020
/switch/.overlays/ovl-KeyX.ovl
```

## å¤šè¯­è¨€

- Chinese is hardcoded, no need to add
- I used AI to translate the English language file. 
- I don't understand other languages, and AI is even worse at it
- You can refer to en.json to add support for other languages

```
SUPPORTED LANGUAGES:
  - en.json       (English)
  - zh-cn.json    (No need to add, already hardcoded)
  - zh-tw.json    (Traditional Chinese)
  - ja.json       (Japanese)
  - ko.json       (Korean)
  - fr.json       (French)
  - de.json       (German)
  - it.json       (Italian)
  - es.json       (Spanish)
  - pt.json       (Portuguese)
  - ru.json       (Russian)
  - nl.json       (Dutch)
```

## ç¼–è¯‘

```bash
cd sys-KeyX && make -j
cd ovl-KeyX && make -j
```
æˆ–è€…ç›´æ¥æ ¹ç›®å½•

```bash
cd KeyX && make
```

## æ„Ÿè°¢

- [libnx](https://github.com/switchbrew/libnx) - Switch å¼€å‘åº“
- [libultrahand](https://github.com/ppkantorski/libultrahand) - Tesla Overlay æ¡†æ¶
- [minIni-nx](https://github.com/ITotalJustice/minIni-nx) - INI é…ç½®æ–‡ä»¶è§£æåº“


---

<a name="english"></a>
# English

**If you are interested in the notification module, visit [NX-Notification](https://github.com/TOM-BadEN/NX-Notification)**

## Notice

- **Note: Due to the special underlying mechanism of SWITCH, some functions may have flaws. See the table below for details.**
- I am not a professional programmer. I have tried my best. Although there are flaws, at least all functions are usable.
- To perfectly implement all functions, it requires MITM hijacking through Atmosphere, but I don't know how, and it would require a complete refactoring.

## Current Function Performance Issues

My OLED+JC will arrive in the next few days. I will conduct detailed testing and attempt to fix the issues, but based on what I currently know and previous failed attempts, both mine and othersâ€™ tests, the probability of successfully fixing the JC-related problems is very low.

| Function | Joycon | LITE |
|----------|--------|------|
| Turbo | Pressing only the turbo button works fine, but inputting other buttons or using the joystick during turbo performs poorly (to be fixed) | Perfect |
| Key Mapping | Perfect | Perfect |
| Macro | After macro ends, stick may fail to reset, touch the stick to restore | Perfect |

| Combined Functions | Joycon | LITE |
|--------------------|--------|------|
| Turbo + Mapping | Same as Turbo | Perfect |
| Turbo + Macro | Turbo function temporarily disabled during macro playback | Turbo function temporarily disabled during macro playback |
| Mapping + Macro | If the keys being played have been remapped, incorrect input may occur | If the keys being played have been remapped, incorrect input may occur |

## Project Implementation Principle

By allocating a 'HDLs buffer' on 'HID memory'.
Using APIs like 'hidGetNpadStatesHandheld' to read button and stick data from the controller (which actually reads from HID memory),
processing the data through algorithms to modify button and stick data,
then using 'hiddbgApplyHdlsStateList' to inject it back into HID memory (where the buttons take effect).

However, this method has the following issues:

1. The injected button and joystick data can be read again by hidGetNpadStatesHandheld, which prevents the program from reading the actual user input. Fortunately, through algorithmic control, the program can still run correctly, albeit imperfectly. Currently, the JC has the issues listed in the table above, while the LITE performs perfectly.

2. JOY-CON seems to have some unknown special mechanism: if joystick or other buttons are injected, even when the code stops injecting and the user does not touch the controller at all, the joystick continues to trigger. Reading the input shows that the last injected data keeps being read. This issue does not occur on the SWITCH LITE, which is very strange and the cause is unclear. To work around this problem, I temporarily force the JC to set non-Tubro buttons and the joystick to 0 during injection, but this prevents other button operations from working normally while Tubro is active.

3. Using the standard API, after remapping buttons, for example X â†’ Y and Y â†’ X, if we continuously inject Y, the game actually registers Y mixed with X. For the Tubro function, a reverse-mapping algorithm is used to correct this issue, but the underlying cause remains unclear. As for the macro function, it is completely powerless against this problem. Therefore, as mentioned in the table above, if a macro plays a button that happens to be remapped, the input may be incorrect.

**If any experts know how to solve this or the root cause, please enlighten me.**

Currently, the only known perfect solution is to use AMS MITM, by intercepting the game's access to HID memory and setting up a shadow memory, so the game only accesses the shadow memory that we fully control. However, I'm not a programmer, and MITM is too complex with no templates or documentation, so I'm unable to do it.

# KeyX Button Assistant

Nintendo Switch button assistant supporting turbo, key remapping, and macro recording. Features global or per-game configuration with auto-start memory.
The complete plugin consists of Tesla overlay and system module.

## Features

![Tesla UI](image/tesla.jpg)       
![Macro Recording](image/recording.jpg)

- Beautiful and modern UI design
- Dynamically modify turbo and mapping settings
- Record macros directly using Tesla overlay with comprehensive guidance
- Optional notification popups
- Blue icons on home page indicate remapped buttons
- Yellow badges indicate turbo-enabled buttons
- Red badges indicate macro-bound buttons

### Key Mapping

- Remap 16 buttons (A/B/X/Y/L/R/ZL/ZR/D-pad/SELECT/START/L3/R3)
- Works together with turbo without conflicts
- **Perfectly avoids system warning popups about button changes**
- Global and per-game configuration
- Auto-remembers on/off state

### Turbo

- Turbo for 12 buttons (A/B/X/Y/L/R/ZL/ZR/D-pad)
- Multiple buttons can turbo simultaneously
- Non-turbo buttons work normally during turbo
- Customizable press and release duration
- Global and per-game configuration
- Auto-remembers on/off state

### Macro

- Auto-remembers macro function on/off state
- Both stick and button states are recorded
- Maximum recording duration: 30 seconds
- Recording frame rate: 60 FPS
- Press shortcut key once for single playback
- Hold shortcut key for loop playback
- Press shortcut key again during playback to cancel

## Memory Usage

- System module: only 343 KB
- Notification popup: extra 688 KB
- **Popup only uses memory when triggered**

## Installation

Copy files to SD card root:

```
/atmosphere/contents/4100000002025924/
/atmosphere/contents/0100000000251020
/switch/.overlays/ovl-KeyX.ovl
```

## Multi-Language

- Chinese is hardcoded, no need to add
- I used AI to translate the English language file
- I don't understand other languages, and AI is even worse at it
- You can refer to en.json to add support for other languages

```
SUPPORTED LANGUAGES:
  - en.json       (English)
  - zh-cn.json    (No need to add, already hardcoded)
  - zh-tw.json    (Traditional Chinese)
  - ja.json       (Japanese)
  - ko.json       (Korean)
  - fr.json       (French)
  - de.json       (German)
  - it.json       (Italian)
  - es.json       (Spanish)
  - pt.json       (Portuguese)
  - ru.json       (Russian)
  - nl.json       (Dutch)
```

## Build

```bash
cd sys-KeyX && make -j
cd ovl-KeyX && make -j
```

Or from root directory:

```bash
cd KeyX && make
```

## Credits

- [libnx](https://github.com/switchbrew/libnx) - Switch development library
- [libultrahand](https://github.com/ppkantorski/libultrahand) - Tesla Overlay framework
- [minIni-nx](https://github.com/ITotalJustice/minIni-nx) - INI config parser library
